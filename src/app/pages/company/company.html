<!-- Global Loader -->
<app-loader [visible]="loading && !isDeleteModalOpen"></app-loader>

<div class="customers-container">
  <div class="customers-actions">
    <!-- <h1 class="customers-title">Company</h1> -->
    <button class="add-customer-btn" routerLink="add" *ngIf="canCreateCompany">
      + Add Company
    </button>
  </div>

  <div class="customers-table-wrapper">
    <div class="table-scroll">
      <table class="customers-table">
        <thead>
          <tr>
            <th>Legal Name</th>
            <th>Company Code</th>
            <th>Email</th>
            <th>Address</th>
            <th *ngIf="showActionsColumn">Actions</th>
          </tr>
        </thead>

        <tbody *ngIf="loading">
          <tr>
            <td
              [attr.colspan]="showActionsColumn ? 5 : 4"
              style="text-align: center; padding: 40px"
            >
              <app-loader [visible]="loading"></app-loader>
            </td>
          </tr>
        </tbody>

        <tbody *ngIf="!loading" class="text-data">
          <tr *ngFor="let c of companies; let i = index">
            <td>
              <div class="company-info">
                <div
                  class="company-initial"
                  [ngStyle]="{
                    backgroundColor: getInitialColor(i).background,
                    color: getInitialColor(i).color
                  }"
                >
                  {{ c?.legalName?.[0] || '?' }}
                </div>
                <span class="company-name">{{ c.legalName }}</span>
              </div>
            </td>
            <td>{{ c.companyCode }}</td>
            <td>{{ c.companyAddress.primaryContactEmail }}</td>

            <td>
              {{ c.companyAddress.addressLine1 }}, {{ c.companyAddress.city }},
              {{ c.companyAddress.stateProvince }}, {{ c.companyAddress.postalCode }},
              {{ c.companyAddress.addressCountry }}
            </td>

            <td class="actions" *ngIf="showActionsColumn">
              <span class="btn-right" *ngIf="canUpdateCompany"
                ><img src="/editIcn.svg" class="action-icon" (click)="editCompany(c.id)"
              /></span>
              <span *ngIf="canDeleteCompany"
                ><img
                  src="/deleteIcn.svg"
                  class="action-icon delete"
                  (click)="openDeleteModal(c.id)"
              /></span>
            </td>
          </tr>
        </tbody>
        <tbody *ngIf="!loading && !companies.length">
          <tr>
            <td [attr.colspan]="showActionsColumn ? 5 : 4" class="no-data-row">
              No companies added yet.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination - Moved inside table wrapper -->
    <div class="pagination-wrapper" *ngIf="totalPages > 1 && !loading">
      <div class="pagination-info">
        Showing {{ currentPage * pageSize + 1 }} to
        {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }} results
      </div>

      <div class="pagination-controls">
        <button class="page-nav-btn" (click)="prevPage()" [disabled]="currentPage === 0">
          <img src="/assets/left.svg" alt="Previous" class="pagination-icon" />
        </button>

        <button
          *ngFor="let page of getPageNumbers()"
          class="page-number-btn"
          [class.active]="page === currentPage + 1"
          [class.ellipsis]="page === -1"
          (click)="page !== -1 && goToPage(page - 1)"
          [disabled]="page === -1"
        >
          {{ page === -1 ? '...' : page }}
        </button>

        <button
          class="page-nav-btn"
          (click)="nextPage()"
          [disabled]="currentPage === totalPages - 1"
        >
          <img src="/assets/right.svg" alt="Next" class="pagination-icon" />
        </button>
      </div>
    </div>
  </div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div class="modal-overlay" *ngIf="isDeleteModalOpen">
  <div class="modal">
    <h3>Delete Company</h3>
    <p>Are you sure you want to delete this company?</p>

    <div class="modal-actions">
      <button class="cancelBtn" (click)="closeDeleteModal()">Cancel</button>

      <button class="deleteBtn" (click)="confirmDelete()" [disabled]="deleting">
        <ng-container *ngIf="!deleting">Delete</ng-container>

        <ng-container *ngIf="deleting">
          <app-spinner></app-spinner>
        </ng-container>
      </button>
    </div>
  </div>
</div>

<router-outlet></router-outlet>
